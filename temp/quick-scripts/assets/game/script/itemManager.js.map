{"version":3,"sources":["itemManager.js"],"names":["mvs","require","GLB","cc","Class","extends","Component","properties","itemPrefabs","Prefab","onLoad","Game","ItemManager","clientEvent","on","eventType","roundStart","scheduleSpawnItem","roundOver","clearScheduleSpawn","gameOver","isRoomOwner","clearInterval","scheduleSpawn","setInterval","GameManager","gameState","GameState","Over","index","dataFunc","randomNum","length","position","v2","msg","action","NEW_ITEM_EVENT","itemIndex","sendEventEx","bind","spawnItemNotify","cpProto","item","destroy","instantiate","parent","node","gamePanel","uiFunc","findUI","gamePanelScript","getComponent","nodeDict","onDestroy","off"],"mappings":";;;;;;AAAA,IAAIA,MAAMC,QAAQ,SAAR,CAAV;AACA,IAAIC,MAAMD,QAAQ,KAAR,CAAV;;AAEAE,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,qBAAa,CAACL,GAAGM,MAAJ;AADL,KAHP;;AAOLC,UAPK,oBAOI;AACLC,aAAKC,WAAL,GAAmB,IAAnB;AACAC,oBAAYC,EAAZ,CAAeD,YAAYE,SAAZ,CAAsBC,UAArC,EAAiD,KAAKC,iBAAtD,EAAyE,IAAzE;AACAJ,oBAAYC,EAAZ,CAAeD,YAAYE,SAAZ,CAAsBG,SAArC,EAAgD,KAAKC,kBAArD,EAAyE,IAAzE;AACAN,oBAAYC,EAAZ,CAAeD,YAAYE,SAAZ,CAAsBK,QAArC,EAA+C,KAAKD,kBAApD,EAAwE,IAAxE;AAEH,KAbI;;;AAeLA,wBAAoB,8BAAW;AAC3B,YAAIjB,IAAImB,WAAR,EAAqB;AACjBC,0BAAc,KAAKC,aAAnB;AACH;AACJ,KAnBI;;AAqBLN,uBAAmB,6BAAW;AAC1B,YAAIf,IAAImB,WAAR,EAAqB;AACjBC,0BAAc,KAAKC,aAAnB;AACA,iBAAKA,aAAL,GAAqBC,YAAY,YAAW;AACxC,oBAAIb,KAAKc,WAAL,CAAiBC,SAAjB,KAA+BC,UAAUC,IAA7C,EAAmD;AAC/CN,kCAAc,KAAKC,aAAnB;AACA;AACH;AACD,oBAAIM,QAAQC,SAASC,SAAT,CAAmB,CAAnB,EAAsB,KAAKvB,WAAL,CAAiBwB,MAAjB,GAA0B,CAAhD,CAAZ;AACA,oBAAIC,WAAW9B,GAAG+B,EAAH,CAAM,CAAN,EAASJ,SAASC,SAAT,CAAmB,CAAC,GAApB,EAAyB,GAAzB,CAAT,CAAf;AACA,oBAAII,MAAM;AACNC,4BAAQlC,IAAImC,cADN;AAENC,+BAAWT,KAFL;AAGNI,8BAAUA;AAHJ,iBAAV;AAKAtB,qBAAKc,WAAL,CAAiBc,WAAjB,CAA6BJ,GAA7B;AACH,aAbgC,CAa/BK,IAb+B,CAa1B,IAb0B,CAAZ,EAaP,IAbO,CAArB;AAcH;AACJ,KAvCI;;AAyCLC,qBAAiB,yBAASC,OAAT,EAAkB;AAC/B,YAAI,KAAKC,IAAT,EAAe;AACX,iBAAKA,IAAL,CAAUC,OAAV;AACH;AACD,aAAKD,IAAL,GAAYxC,GAAG0C,WAAH,CAAe,KAAKrC,WAAL,CAAiBkC,QAAQJ,SAAzB,CAAf,CAAZ;AACA,aAAKK,IAAL,CAAUG,MAAV,GAAmB,KAAKC,IAAxB;AACA,YAAIC,YAAYC,OAAOC,MAAP,CAAc,aAAd,CAAhB;AACA,YAAIF,SAAJ,EAAe;AACX,gBAAIG,kBAAkBH,UAAUI,YAAV,CAAuB,aAAvB,CAAtB;AACA,gBAAID,eAAJ,EAAqB;AACjB,oBAAIL,SAASK,gBAAgBE,QAAhB,CAAyB,YAAzB,CAAb;AACA,qBAAKV,IAAL,CAAUG,MAAV,GAAmBA,MAAnB;AACA,qBAAKH,IAAL,CAAUV,QAAV,GAAqBS,QAAQT,QAA7B;AACH;AACJ;AACJ,KAxDI;;AA0DLqB,eAAW,qBAAW;AAClBzC,oBAAY0C,GAAZ,CAAgB1C,YAAYE,SAAZ,CAAsBC,UAAtC,EAAkD,KAAKC,iBAAvD,EAA0E,IAA1E;AACAJ,oBAAY0C,GAAZ,CAAgB1C,YAAYE,SAAZ,CAAsBG,SAAtC,EAAiD,KAAKC,kBAAtD,EAA0E,IAA1E;AACAN,oBAAY0C,GAAZ,CAAgB1C,YAAYE,SAAZ,CAAsBK,QAAtC,EAAgD,KAAKD,kBAArD,EAAyE,IAAzE;AACH;AA9DI,CAAT","file":"itemManager.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\game\\script","sourcesContent":["var mvs = require(\"Matchvs\");\r\nvar GLB = require(\"Glb\");\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        itemPrefabs: [cc.Prefab]\r\n    },\r\n\r\n    onLoad() {\r\n        Game.ItemManager = this;\r\n        clientEvent.on(clientEvent.eventType.roundStart, this.scheduleSpawnItem, this);\r\n        clientEvent.on(clientEvent.eventType.roundOver, this.clearScheduleSpawn, this);\r\n        clientEvent.on(clientEvent.eventType.gameOver, this.clearScheduleSpawn, this);\r\n\r\n    },\r\n\r\n    clearScheduleSpawn: function() {\r\n        if (GLB.isRoomOwner) {\r\n            clearInterval(this.scheduleSpawn);\r\n        }\r\n    },\r\n\r\n    scheduleSpawnItem: function() {\r\n        if (GLB.isRoomOwner) {\r\n            clearInterval(this.scheduleSpawn);\r\n            this.scheduleSpawn = setInterval(function() {\r\n                if (Game.GameManager.gameState === GameState.Over) {\r\n                    clearInterval(this.scheduleSpawn);\r\n                    return;\r\n                }\r\n                var index = dataFunc.randomNum(0, this.itemPrefabs.length - 1);\r\n                var position = cc.v2(0, dataFunc.randomNum(-450, 350));\r\n                var msg = {\r\n                    action: GLB.NEW_ITEM_EVENT,\r\n                    itemIndex: index,\r\n                    position: position\r\n                };\r\n                Game.GameManager.sendEventEx(msg);\r\n            }.bind(this), 5000);\r\n        }\r\n    },\r\n\r\n    spawnItemNotify: function(cpProto) {\r\n        if (this.item) {\r\n            this.item.destroy();\r\n        }\r\n        this.item = cc.instantiate(this.itemPrefabs[cpProto.itemIndex]);\r\n        this.item.parent = this.node;\r\n        var gamePanel = uiFunc.findUI(\"uiGamePanel\");\r\n        if (gamePanel) {\r\n            var gamePanelScript = gamePanel.getComponent(\"uiGamePanel\");\r\n            if (gamePanelScript) {\r\n                var parent = gamePanelScript.nodeDict[\"itemParent\"];\r\n                this.item.parent = parent;\r\n                this.item.position = cpProto.position;\r\n            }\r\n        }\r\n    },\r\n\r\n    onDestroy: function() {\r\n        clientEvent.off(clientEvent.eventType.roundStart, this.scheduleSpawnItem, this);\r\n        clientEvent.off(clientEvent.eventType.roundOver, this.clearScheduleSpawn, this);\r\n        clientEvent.off(clientEvent.eventType.gameOver, this.clearScheduleSpawn, this);\r\n    }\r\n});\r\n"]}