{"version":3,"sources":["playerManager.js"],"names":["mvs","require","GLB","cc","Class","extends","Component","properties","friendPrefabs","Prefab","enemyPrefabs","friendPosX","enemyPosX","onLoad","Game","PlayerManager","players","clientEvent","on","eventType","roundStart","initPlayers","gameOver","checkIsRoundOver","enemyDiedCnt","friendDiedCnt","i","length","playerScript","getComponent","isDied","camp","Camp","Friend","getLoseCamp","loseCamp","None","Enemy","uiGamePanel","uiFunc","findUI","j","position","v2","init","userId","player","campFlg","playerUserIds","instantiate","parent","push","setLocalZOrder","getPlayerByUserId","onDestroy","off"],"mappings":"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","file":"playerManager.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\game\\script","sourcesContent":["var mvs = require(\"Matchvs\");\r\nvar GLB = require(\"Glb\");\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        friendPrefabs: [cc.Prefab],\r\n        enemyPrefabs: [cc.Prefab],\r\n        friendPosX: 0,\r\n        enemyPosX: 0\r\n    },\r\n\r\n    onLoad() {\r\n        Game.PlayerManager = this;\r\n        this.players = [];\r\n        clientEvent.on(clientEvent.eventType.roundStart, this.initPlayers, this);\r\n        clientEvent.on(clientEvent.eventType.gameOver, this.gameOver, this);\r\n\r\n    },\r\n\r\n    gameOver: function() {\r\n        this.players = [];\r\n    },\r\n\r\n    checkIsRoundOver: function() {\r\n        var enemyDiedCnt = 0;\r\n        var friendDiedCnt = 0;\r\n        for (var i = 0; i < this.players.length; i++) {\r\n            var playerScript = this.players[i].getComponent('player');\r\n            if (playerScript && playerScript.isDied) {\r\n                if (playerScript.camp === Camp.Friend) {\r\n                    friendDiedCnt++;\r\n                } else {\r\n                    enemyDiedCnt++;\r\n                }\r\n            }\r\n        }\r\n        if (enemyDiedCnt >= this.players.length / 2 || friendDiedCnt >= this.players.length / 2) {\r\n            return true;\r\n        }\r\n        return false;\r\n    },\r\n\r\n    getLoseCamp: function() {\r\n        var enemyDiedCnt = 0;\r\n        var friendDiedCnt = 0;\r\n        for (var i = 0; i < this.players.length; i++) {\r\n            var playerScript = this.players[i].getComponent('player');\r\n            if (playerScript && playerScript.isDied) {\r\n                if (playerScript.camp === Camp.Friend) {\r\n                    friendDiedCnt++;\r\n                } else {\r\n                    enemyDiedCnt++;\r\n                }\r\n            }\r\n        }\r\n        var loseCamp = null;\r\n        if (enemyDiedCnt >= this.players.length / 2 && friendDiedCnt >= this.players.length / 2) {\r\n            loseCamp = Camp.None;\r\n        } else if (enemyDiedCnt >= this.players.length / 2) {\r\n            loseCamp = Camp.Enemy;\r\n        } else if (friendDiedCnt >= this.players.length / 2) {\r\n            loseCamp = Camp.Friend;\r\n        }\r\n        return loseCamp;\r\n    },\r\n\r\n    // 初始化玩家--\r\n    initPlayers: function() {\r\n        var uiGamePanel = uiFunc.findUI(\"uiGamePanel\");\r\n        if (!uiGamePanel) {\r\n            return;\r\n        }\r\n        var playerScript = null;\r\n        if (this.players && this.players.length > 0) {\r\n            for (var j = 0; j < this.players.length; j++) {\r\n                playerScript = this.players[j].getComponent(\"player\");\r\n                if (playerScript) {\r\n                    if (playerScript.camp === Camp.Friend) {\r\n                        playerScript.position = cc.v2(this.friendPosX, -500);\r\n                    } else {\r\n                        playerScript.position = cc.v2(this.enemyPosX, -500);\r\n                    }\r\n                    playerScript.init(playerScript.userId);\r\n                }\r\n            }\r\n        } else {\r\n            var player = null;\r\n            this.players = [];\r\n            var campFlg = GLB.playerUserIds.length / 2;\r\n            for (var i = 0; i < GLB.playerUserIds.length; i++) {\r\n                if (i < campFlg) {\r\n                    // 友方\r\n                    player = cc.instantiate(this.friendPrefabs[i]);\r\n                    player.parent = uiGamePanel;\r\n                    player.position = cc.v2(this.friendPosX, -500);\r\n                } else {\r\n                    // 敌方\r\n                    player = cc.instantiate(this.enemyPrefabs[i - campFlg]);\r\n                    player.parent = uiGamePanel;\r\n                    player.position = cc.v2(this.enemyPosX, -500);\r\n                }\r\n                playerScript = player.getComponent(\"player\");\r\n                if (playerScript) {\r\n                    playerScript.init(GLB.playerUserIds[i]);\r\n                }\r\n                this.players.push(player);\r\n            }\r\n            this.players[0].setLocalZOrder(999);\r\n        }\r\n    },\r\n\r\n    getPlayerByUserId: function(userId) {\r\n        for (var i = 0; i < GLB.playerUserIds.length; i++) {\r\n            if (GLB.playerUserIds[i] === userId && this.players && this.players[i]) {\r\n                return this.players[i].getComponent(\"player\");\r\n            }\r\n        }\r\n        return null;\r\n    },\r\n\r\n    onDestroy: function() {\r\n        clientEvent.off(clientEvent.eventType.roundStart, this.initPlayers, this);\r\n        clientEvent.off(clientEvent.eventType.gameOver, this.gameOver, this);\r\n\r\n    }\r\n});\r\n"]}